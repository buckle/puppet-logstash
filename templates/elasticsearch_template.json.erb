# Managed by puppet
# elasticsearch logstash index template file

{
  "template": "<%=template_name %>",
  "settings": {
    "number_of_shards": <%=number_of_shards %>,
    "number_of_replicas": <%=number_of_replicas %>,
    "index": {
      "query" : { "default_field" : "<%=query_default_field %>" },
<% if @store_compress == true -%>
      "store" : { "compress" : { "stored" : true, "tv": true } }
<% end -%>
    }
  },
  "mappings": {
    "_default_": { 
<% if @all_enabled == true -%>
      "_all": { "enabled": true },
<% end -%>
<% if @source_compress == true -%>      
      "_source": { "compress": true },
<% end -%>
      "dynamic_templates": [
        {
          "string_template" : { 
            "match" : "*",
            "mapping": { "type": "string", "index": "not_analyzed" },
            "match_mapping_type" : "string"
          } 
        }
      ],
      "properties" : {
        "@fields": { "type": "object", "dynamic": true, "path": "full" }, 
        "@message" : { "type" : "string", "index" : "analyzed" },
        "@source" : { "type" : "string", "index" : "not_analyzed" },
        "@source_host" : { "type" : "string", "index" : "not_analyzed" },
        "@source_path" : { "type" : "string", "index" : "not_analyzed" },
        "@tags": { "type": "string", "index" : "not_analyzed" }, 
        "@timestamp" : { "type" : "date", "index" : "not_analyzed" },
        "@type" : { "type" : "string", "index" : "not_analyzed" }
      }
    }
  }
}

